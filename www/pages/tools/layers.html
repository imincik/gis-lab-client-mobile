<ons-page ng-controller="LayersController">
	<div class="tab-bar tab-bar--top">
		<label class="tab-bar__item">
			<input type="radio" name="layers-tab-radio" value="0" ng-model="ui.tools_layers_tab">
			<button class="tab-bar__button">
				<i class="tab-bar__icon ion-android-map"></i>
				<div class="tab-bar__label">Base layer</div>
			</button>
		</label>

		<label class="tab-bar__item">
			<input type="radio" name="layers-tab-radio" value="1" ng-model="ui.tools_layers_tab">
			<button class="tab-bar__button">
				<i class="tab-bar__icon ion-social-buffer"></i>
				<div class="tab-bar__label">Layers</div>
			</button>
		</label>

		<label class="tab-bar__item">
			<input type="radio" name="layers-tab-radio" value="2" ng-model="ui.tools_layers_tab">
			<button class="tab-bar__button">
				<i class="tab-bar__icon ion-android-color-palette"></i>
				<div class="tab-bar__label">Legend</div>
			</button>
		</label>
	</div>
	<gl-carousel-tab-slider gl-tab-model="ui.tools_layers_tab" gl-carousel="app.panel.carousel"></gl-carousel-tab-slider>

	<ons-carousel var="app.panel.carousel" class="map-panel" style="width: 100%; height: {{ panelHeight }}px" swipeable auto-scroll>
		<ons-carousel-item>
			<ons-scroller style="height: {{ panelHeight }}px;">
				<ons-list class="baselayer-container gl-tree"
					gl-tree-view="baseLayers.tree"
					gl-tree-label-attribute="title"
					gl-tree-children-attribute="layers"
					gl-tree-selected-attribute="visible"
					gl-tree-view-change-handler="setBaseLayer(node.name)">

					<div gl-tree-group-template>
						<ons-list-item class="group" modifier="tapable" depth="{{ ::treeDepth }}" ng-click="isExpanded=!isExpanded">
							<span class="indent"></span>
							<i class="fa toggle-button" ng-class="{expanded: isExpanded}"></i>
							{{ node.title }}
						</ons-list-item>
						<div class="group-content" ng-show="isExpanded" gl-height-animation>
							<div ng-repeat="child in node.layers" gl-tree-node="child"></div>
						</div>
					</div>

					<div gl-tree-leaf-template>
						<ons-list-item modifier="chevron" class="leaf" depth="{{ ::treeDepth }}">
							<span class="indent"></span>
							<label class="radio-button">
								<input type="radio" name="baselayer-radio" ng-model="node.selected.name" value="{{ ::node.name }}" ng-change="nodeSelected(node)"/>
								<div class="radio-button__icon-checkmark"></div>
							</label>
							{{ node.title }}
						</ons-list-item>
					</div>

					<div ng-repeat="n in root" gl-tree-node="n"></div>
				</ons-list>
			</ons-scroller>
		</ons-carousel-item>

		<ons-carousel-item>
			<ons-scroller style="height: {{ panelHeight }}px;">
				<ons-list class="layers-container gl-tree"
					gl-check-tree-view="layers.tree"
					gl-tree-label-attribute="title"
					gl-tree-children-attribute="layers"
					gl-tree-selected-attribute="visible"
					gl-tree-view-change-handler="layersVisibilityChanged()">

						<div gl-tree-group-template>
							<ons-list-item class="group" modifier="tappable" depth="{{ ::treeDepth }}" gl-click="isExpanded=!isExpanded">
								<span class="indent"></span>
								<i class="fa toggle-button" ng-class="{expanded: isExpanded}"></i>
								<label class="checkbox" gl-click="$event.stopPropagation();">
									<input type="checkbox" ng-model="node.visible" ng-change="nodeSelected(node, node.visible)"/>
									<div class="checkbox__icon-checkmark"></div>
								</label>
								<div class="node-label">{{ node.title }}</div>
							</ons-list-item>
							<div class="group-content" ng-show="isExpanded" gl-height-animation>
								<div ng-repeat="child in node.layers" gl-check-tree-node="child"></div>
							</div>
						</div>

						<div gl-tree-leaf-template>
							<ons-list-item modifier="tappable" class="leaf" depth="{{ ::treeDepth }}" gl-click="toggleAccordion(node)">
								<span class="indent"></span>
								<label class="checkbox" gl-click="$event.stopPropagation();">
									<input type="checkbox" ng-model="node.visible" ng-change="nodeSelected(node, node.visible)"/>
									<div class="checkbox__icon-checkmark"></div>
								</label>
								{{ node.title }}
							</ons-list-item>
							<div class="list-item-detail item-accordion" ng-show="isAccordionShown(node)" gl-fixed-height>
								<label>Abstract:</label><span>{{ node.metadata.abstract }}</span>
								<label>Title:</label><span>{{ node.metadata.title }}</span>
							</div>
						</div>

						<div ng-controller="AccordionController">
							<div ng-repeat="n in root" gl-check-tree-node="n"></div>
						</div>
				</ons-list>
			</ons-scroller>
		</ons-carousel-item>

		<ons-carousel-item>
			<ons-scroller style="height: {{ panelHeight }}px;">
				<div class="legend-container">
					<img class="legend-item" ng-repeat="layer in layers.list" ng-if="layer.visible && !layer.isGroup" ng-src="{{ layer.legendUrl }}" />
				</div>
			</ons-scroller>
		</ons-carousel-item>
	</ons-carousel>
</ons-page>
