<ons-page ng-controller="LayersController">
	<div class="panel-header" ng-if="$storage.showHeader">
		<span>{{ ['Topics', 'Base Layer', 'Layers'][app.panel.carousel._lastActiveIndex] }}</span>
	</div>
	<ons-carousel var="app.panel.carousel" class="map-panel" style="width: 100%; height: {{ panelHeight-28 }}px;" swipeable auto-scroll>
		<ons-carousel-item>
			<ons-scroller style="height: 100%;" ng-if="::topics">
				<ons-list class="topics" ng-controller="AccordionController">
					<div ng-repeat="topic in ::topics">
						<ons-list-item class="list__item--checkbox list__item--accordion" modifier="tappable" ng-class="{expanded: isAccordionShown(topic)}">
							<ons-row>
								<ons-col width="36px">
									<label class="radio-button">
										<input type="radio" name="topics-radio" ng-model="selectedTopic.index" value="{{ ::$index }}" ng-change="loadTopic(topic)"/>
<!--										<div class="radio-button__icon-checkmark"></div>-->
										<div class="radio-button__icon-checkmark">
											<div class="radio-button__icon-checkmark-fill"></div>
										</div>
									</label>
								</ons-col>
								<ons-col class="left-center">
									<span class="title">{{ ::topic.title }}</span>
								</ons-col>
<!--								<ons-col width="30px">-->
<!--									<div ng-click="topicDetail(topic, toggleAccordion);" class="toggle-btn">&nbsp;</div>-->
<!--								</ons-col>-->
								<div class="expand-button" ng-click="topicDetail(topic, toggleAccordion)">&nbsp;</div>
							<ons-row>
						</ons-list-item>
						<ons-list-item class="list__item--accordion-content" ng-if="topic.detail" ng-show="isAccordionShown(topic)" gl-fixed-height>
							<div>
								<label>Abstract:</label>
								<span>{{ ::topic.detail.abstract }}</span><br />
								<label>Visible layers:</label>
								<div class="topic-visible-layers">
<!--								<span>{{ ::topic.visible_overlays.join(', ') }}</span>-->
									<span ng-bind-html="::topic.detail.visibleLayers"></span>
								</div>
								<div style="height: 8px;"/>
							</div>
						</ons-list-item>
					</div>
				</ons-list>
			</ons-scroller>
			<div class="empty-tab" ng-if="::!topics">
				<span>Project doesn't have any topics.</span>
			</div>
		</ons-carousel-item>

		<ons-carousel-item>
			<ons-scroller style="height: 100%;">
				<ons-list class="baselayer-container gl-tree"
					gl-tree-view="baseLayers.tree"
					gl-tree-label-attribute="title"
					gl-tree-children-attribute="layers"
					gl-tree-selected-attribute="visible"
					gl-tree-view-change-handler="setBaseLayer(node.name)">

					<div gl-tree-group-template>
						<ons-list-item class="group" modifier="tappable" depth="{{ ::treeDepth }}" ng-click="isExpanded=!isExpanded">
							<ons-row>
								<ons-col class="indent" width="36px">
									<i class="fa toggle-button" ng-class="{expanded: isExpanded}"></i>
								</ons-col>
								<ons-col class="left-center title">
									<span>{{ ::node.title }}</span>
								</ons-col>
							</ons-row>
						</ons-list-item>
						<div class="group-content" ng-show="isExpanded" gl-height-animation>
							<div ng-repeat="child in node.layers" gl-tree-node="child"></div>
						</div>
					</div>

					<div gl-tree-leaf-template>
						<ons-list-item modifier="tappable" class="list__item--checkbox list__item--accordion leaf" depth="{{ ::treeDepth }}" ng-class="{expanded: isAccordionShown(node)}">
							<ons-row>
								<ons-col class="indent" width="36px">
									<label class="radio-button">
										<input type="radio" name="baselayer-radio" ng-model="node.selected.name" value="{{ ::node.name }}" ng-change="nodeSelected(node)"/>
										<div class="radio-button__icon-checkmark">
											<div class="radio-button__icon-checkmark-fill"></div>
										</div>
									</label>
								</ons-col>
								<ons-col class="left-center">
									<span class="title">{{ ::node.title }}</span>
								</ons-col>
								<div class="expand-button" ng-click="toggleAccordion(node)">&nbsp;</div>
							</ons-row>
						</ons-list-item>
						<ons-list-item class="list__item--accordion-content" ng-show="isAccordionShown(node)" gl-fixed-height>
							<label>Abstract:</label><span> {{ ::node.metadata.abstract }}</span><br />
							<label>Keywords list:</label><span> {{ ::node.metadata.keyword_list }}</span><br />
							<label>Maximal scale:</label><span> 1: {{ ::node.visibility_scale_min | number : 0 }}</span><br />
							<label>Minimal scale:</label><span> 1: {{ ::node.visibility_scale_max | number : 0 }}</span><br />
							<div style="height: 8px;"/>
						</ons-list-item>
					</div>
					<div ng-controller="AccordionController">
						<div ng-repeat="n in root" gl-tree-node="n"></div>
					</div>
				</ons-list>
			</ons-scroller>
		</ons-carousel-item>

		<ons-carousel-item>
			<ons-scroller style="height: 100%;" ng-if="::layers.tree">
				<ons-list class="layers-container gl-tree"
					gl-check-tree-view="layers.tree"
					gl-tree-label-attribute="title"
					gl-tree-children-attribute="layers"
					gl-tree-selected-attribute="visible"
					gl-tree-view-change-handler="layersVisibilityChanged()">

						<div gl-tree-group-template>
							<ons-list-item class="group list__item--checkbox" modifier="tappable" depth="{{ ::treeDepth }}" gl-click="isExpanded=!isExpanded">
								<ons-row>
									<ons-col class="indent" width="54px">
										<i class="fa toggle-button" ng-class="{expanded: isExpanded}"></i>
										<label class="checkbox" gl-click="$event.stopPropagation();">
											<input type="checkbox" ng-model="node.visible" ng-change="nodeSelected(node, node.visible)"/>
											<div class="checkbox__icon-checkmark"></div>
										</label>
									</ons-col>
									<ons-col class="left-center">
										<span class="title">{{ ::node.title }}</span>
									</ons-col>
								</ons-row>
							</ons-list-item>
							<div class="group-content" ng-show="isExpanded" gl-height-animation>
								<div ng-repeat="n in node.layers" gl-check-tree-node="n"></div>
							</div>
						</div>

						<div gl-tree-leaf-template>
							<ons-list-item modifier="tappable" class="list__item--checkbox list__item--accordion leaf" depth="{{ ::treeDepth }}" ng-class="{expanded: isAccordionShown(node)}">
								<ons-row>
									<ons-col class="indent" width="36px">
										<label class="checkbox">
											<input type="checkbox" ng-model="node.visible" ng-change="nodeSelected(node, node.visible)"/>
											<div class="checkbox__icon-checkmark"></div>
										</label>
									</ons-col>
									<ons-col class="left-center">
										<span class="title">{{ ::node.title }}</span>
									</ons-col>
									<div class="expand-button" ng-click="toggleAccordion(node)">&nbsp;</div>
								</ons-row>
							</ons-list-item>
							<ons-list-item class="list__item--accordion-content" ng-show="isAccordionShown(node)" gl-fixed-height>
								<label>Geometry:</label><span class="layer-metadata-icon {{::node.geom_type | lowercase}}-layer-icon"></span><br />
								<label>Identification:</label>
<!--									<span> {{ ::node.queryable? 'Yes' : 'No' }}</span>-->
									<i class="layer-metadata-icon fa" ng-class="node.queryable? 'fa-check' : 'fa-minus'"></i>
								<br />
								<label>Abstract:</label><span> {{ ::node.metadata.abstract }}</span><br />
								<label>Keywords list:</label><span> {{ ::node.metadata.keyword_list }}</span><br />
								<label>Maximal scale:</label><span> 1: {{ ::node.visibility_scale_min | number : 0 }}</span><br />
								<label>Minimal scale:</label><span> 1: {{ ::node.visibility_scale_max | number : 0 }}</span><br />
								<label>Labels:</label><i class="layer-metadata-icon fa" ng-class="node.labels? 'fa-check' : 'fa-minus'"></i>
								<div style="height: 8px;"/>
							</ons-list-item>
						</div>

						<div ng-controller="AccordionController">
							<div ng-repeat="n in root" gl-check-tree-node="n"></div>
						</div>
				</ons-list>
			</ons-scroller>
			<div class="empty-tab" ng-if="::!layers.tree">
				<span>Project doesn't have any overlay layers.</span>
			</div>
		</ons-carousel-item>
	</ons-carousel>
	<gl-carousel-tab-slider gl-tab-model="ui.tools_layers_tab" gl-carousel="app.panel.carousel"></gl-carousel-tab-slider>
	<div class="tab-bar tab-bar--bottom">
		<label class="tab-bar__item">
			<input type="radio" name="layers-tab-radio" value="0" ng-model="ui.tools_layers_tab">
			<button class="tab-bar__button">
				<i class="tab-bar__icon ion-images"></i>
			</button>
		</label>

		<label class="tab-bar__item border-both">
			<input type="radio" name="layers-tab-radio" value="1" ng-model="ui.tools_layers_tab">
			<button class="tab-bar__button">
				<i class="tab-bar__icon ion-android-map"></i>
			</button>
		</label>

		<label class="tab-bar__item">
			<input type="radio" name="layers-tab-radio" value="2" ng-model="ui.tools_layers_tab">
			<button class="tab-bar__button">
				<i class="tab-bar__icon ion-social-buffer"></i>
			</button>
		</label>
	</div>
</ons-page>
